{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cotizaciones - SIEER Chile</title>

  <!-- Dependencias -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <link rel="stylesheet" href="{% static 'css/admin_panel.css' %}">

  <style>
    /* ===== Enhancements para listado de cotizaciones ===== */
    .content-header {
      display: flex; gap: .75rem; align-items: center; justify-content: space-between;
      margin-bottom: 1rem;
    }
    .toolbar {
      display:flex; gap:.6rem; align-items:center; flex-wrap:wrap;
    }
    .search {
      display:flex; align-items:center; gap:.45rem;
      background: var(--light); border:1px solid var(--light-gray);
      padding:.45rem .6rem; border-radius:10px;
    }
    .search i{ color: var(--gray); }
    .search input{
      border:none; outline:none; background:transparent; min-width: 220px;
    }
    .filter-select{
      border:1px solid var(--light-gray); background:#fff; color:#333;
      padding:.45rem .6rem; border-radius:10px;
    }

    .table-card{
      background:#fff; border-radius:14px; box-shadow: var(--box-shadow);
      overflow: hidden; border: 1px solid var(--light-gray);
    }
    .table-card .card-head{
      padding: .9rem 1rem; border-bottom:1px solid var(--light-gray);
      display:flex; align-items:center; gap:.5rem; justify-content:space-between;
    }
    .table-responsive{ overflow-x:auto; }

    .styled-table{
      width:100%; border-collapse: collapse; font-size:.95rem;
    }
    .styled-table thead th{
      position: sticky; top: 0; background: #f7f9fc; z-index: 1;
      text-align:left; padding: .9rem 1rem; border-bottom:1px solid var(--light-gray);
      font-weight:600; color:#364152;
    }
    .styled-table tbody td{
      padding: .85rem 1rem; border-bottom:1px solid var(--light-gray);
      color:#2b3340;
    }
    .styled-table tbody tr:hover{ background:#fafcff; }

    .badge{
      display:inline-flex; align-items:center; gap:.35rem;
      padding:.28rem .6rem; border-radius:999px; color:#fff; font-size:.82rem;
      font-weight:600;
    }
    .badge-success{ background:#16a34a; }   /* Aprobada   */
    .badge-warning{ background:#f59e0b; }   /* Pendiente  */
    .badge-secondary{ background:#6b7280; } /* Otros      */

    .table-actions{ display:flex; gap:.4rem; }
    .btn-sm{ padding:.35rem .55rem; font-size:.85rem; border-radius:8px; }
    .btn-outline{ background:#fff; border:1px solid var(--light-gray); }
    .btn-outline:hover{ background:#f3f6fb; }
    .btn-danger{ background:#dc3545; color:#fff; border:none; }
    .btn-danger:hover{ filter:brightness(0.95); }

    .empty-state{
      padding: 2rem; text-align:center; color: var(--gray);
    }
    .empty-state i{ color:#94a3b8; }
  </style>
</head>

<body>
<div class="admin-container">
  <!-- Sidebar -->
  <aside class="admin-sidebar">
    <div class="sidebar-header">
      <div class="admin-logo">
        <img src="{% static 'img/logo.png' %}" alt="SIEER Chile Logo">
        <div class="logo-text">
          <h2>SIEER Chile</h2>
          <span>Panel Administrativo</span>
        </div>
      </div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section">
        <h3>Facturación</h3>
        <ul>
          <li class="nav-item">
            <a href="#"><i class="fas fa-file-invoice"></i><span>Boleta y Factura Electrónica</span></a>
          </li>
          <li class="nav-item">
            <a href="#"><i class="fas fa-calculator"></i><span>Cálculos y Estadísticas</span></a>
          </li>
          <li class="nav-item {% if 'cotizaciones' in request.path %}active{% endif %}">
            <a href="{% url 'cotizaciones' %}"><i class="fas fa-file-alt"></i><span>Cotizaciones</span></a>
          </li>
          <li class="nav-item">
            <a href="#"><i class="fas fa-boxes"></i><span>Control de Inventario</span></a>
          </li>
        </ul>
      </div>

      <div class="nav-section">
        <h3>Reportes</h3>
        <ul>
          <li class="nav-item"><a href="#"><i class="fas fa-chart-bar"></i><span>Reportes Gráficos</span></a></li>
          <li class="nav-item"><a href="#"><i class="fas fa-history"></i><span>Historia de Ventas</span></a></li>
          <li class="nav-item"><a href="#"><i class="fas fa-user-cog"></i><span>Cuenta</span></a></li>
          <li class="nav-item"><a href="#"><i class="fas fa-cogs"></i><span>Configuración</span></a></li>
        </ul>
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-avatar"><i class="fas fa-user-shield"></i></div>
        <div class="user-details"><strong>Administrador</strong><span>{{ user.username }}</span></div>
      </div>
      <form method="post" action="{% url 'logout' %}" class="logout-form">
        {% csrf_token %}
        <button type="submit" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</button>
      </form>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="admin-main">
    <!-- Header -->
    <header class="admin-header">
      <div class="header-left">
        <button class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></button>
        <h1>Cotizaciones</h1>
      </div>
      <div class="header-right">
        <a class="btn btn-primary" href="/"><i class="fas fa-eye"></i> Ver Sitio Web</a>
      </div>
    </header>

    <!-- Contenido principal -->
    <div class="admin-content">
      <div class="content-header">
        <h2>Gestión de Cotizaciones</h2>

        <div class="toolbar">
          <!-- Filtro / búsqueda vía GET (opcional) -->
          <form method="get" action="{% url 'cotizaciones' %}" class="search">
            <i class="fas fa-search"></i>
            <input type="text" name="q" placeholder="Buscar cliente o #ID" value="{{ request.GET.q }}">
          </form>

          <form method="get" action="{% url 'cotizaciones' %}">
            <select name="estado" class="filter-select" onchange="this.form.submit()">
              <option value="">Todos los estados</option>
              <option value="Pendiente" {% if request.GET.estado == 'Pendiente' %}selected{% endif %}>Pendiente</option>
              <option value="Aprobada" {% if request.GET.estado == 'Aprobada' %}selected{% endif %}>Aprobada</option>
              <option value="Rechazada" {% if request.GET.estado == 'Rechazada' %}selected{% endif %}>Rechazada</option>
            </select>
          </form>

          <a class="btn btn-primary" href="{% url 'crear_cotizacion' %}">
            <i class="fas fa-plus"></i> Nueva Cotización
          </a>
        </div>
      </div>

      <div class="table-card">
        <div class="card-head">
          <span><i class="fas fa-table"></i> Listado</span>
          <span style="color:#64748b;">Total: {{ cotizaciones|length }}</span>
        </div>

        {% if cotizaciones %}
        <div class="table-responsive">
          <table class="styled-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Cliente</th>
                <th>Fecha</th>
                <th>Monto</th>
                <th>Estado</th>
                <th style="width:140px;">Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for cot in cotizaciones %}
              <tr>
                <td>#{{ cot.id }}</td>
                <td>{{ cot.cliente }}</td>
                <td>{{ cot.fecha|date:"d/m/Y" }}</td>
                <td>${{ cot.total }}</td>
                <td>
                  <span class="badge {% if cot.estado == 'Aprobada' %}badge-success{% elif cot.estado == 'Pendiente' %}badge-warning{% else %}badge-secondary{% endif %}">
                    {{ cot.estado }}
                  </span>
                </td>
                <td>
                  <div class="table-actions">
                    <a href="{% url 'ver_cotizacion' cot.id %}" class="btn btn-outline btn-sm" title="Ver"><i class="fas fa-eye"></i></a>
                    <a href="{% url 'editar_cotizacion' cot.id %}" class="btn btn-outline btn-sm" title="Editar"><i class="fas fa-edit"></i></a>
                    <a href="{% url 'eliminar_cotizacion' cot.id %}" class="btn btn-danger btn-sm" title="Eliminar"><i class="fas fa-trash"></i></a>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="empty-state">
          <i class="fas fa-file-invoice" style="font-size: 3rem; margin-bottom: .6rem;"></i>
          <h3>No hay cotizaciones registradas</h3>
          <p>Comienza agregando una nueva cotización.</p>
          <a class="btn btn-primary" href="{% url 'crear_cotizacion' %}"><i class="fas fa-plus"></i> Crear Cotización</a>
        </div>
        <div class="content-header">
  <h2>Gestión de Cotizaciones</h2>
  <div class="toolbar">
    <form method="get" action="{% url 'cotizaciones' %}" class="search">
      <i class="fas fa-search"></i>
      <input type="text" name="q" placeholder="Buscar cliente o #ID" value="{{ request.GET.q }}">
    </form>

    <form method="get" action="{% url 'cotizaciones' %}">
      <select name="estado" class="filter-select" onchange="this.form.submit()">
        <option value="">Todos los estados</option>
        <option value="Pendiente" {% if request.GET.estado == 'Pendiente' %}selected{% endif %}>Pendiente</option>
        <option value="Aprobada" {% if request.GET.estado == 'Aprobada' %}selected{% endif %}>Aprobada</option>
        <option value="Rechazada" {% if request.GET.estado == 'Rechazada' %}selected{% endif %}>Rechazada</option>
      </select>
    </form>

    <a class="btn btn-primary" href="{% url 'crear_cotizacion' %}">
      <i class="fas fa-plus"></i> Nueva Cotización
    </a>
  </div>
</div>

        {% endif %}
      </div>
    </div>
  </main>
</div>


<script src="{% static 'js/admin_panel.js' %}"></script>
</body>
</html>
