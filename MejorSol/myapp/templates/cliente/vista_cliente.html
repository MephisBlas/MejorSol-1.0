{% extends 'base.html' %}
{% load static %}

{% block title %}Productos - SIEER Chile{% endblock %}

{% block content %}
<div class="container" style="padding: 2rem 0;">
    <h1 style="text-align: center; margin-bottom: 2rem; color: var(--primary);">Nuestros Productos</h1>
    
    <!-- Filtros y búsqueda -->
    <div style="background: var(--light); padding: 1.5rem; border-radius: 10px; margin-bottom: 2rem;">
        <form method="get" style="display: flex; gap: 1rem; align-items: end; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 200px;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Buscar producto:</label>
                <input type="text" name="q" value="{{ request.GET.q }}" 
                       placeholder="Nombre del producto..."
                       style="width: 100%; padding: 0.5rem; border: 1px solid var(--light-gray); border-radius: 5px;">
            </div>
            
            <div style="flex: 1; min-width: 200px;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Categoría:</label>
                <select name="categoria" style="width: 100%; padding: 0.5rem; border: 1px solid var(--light-gray); border-radius: 5px;">
                    <option value="">Todas las categorías</option>
                    {% for categoria in categorias %}
                        <option value="{{ categoria.id }}" 
                                {% if request.GET.categoria == categoria.id|stringformat:"i" %}selected{% endif %}>
                            {{ categoria.nombre }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search"></i> Buscar
                </button>
                <a href="{% url 'vista_cliente' %}" class="btn btn-outline">
                    <i class="fas fa-refresh"></i> Limpiar
                </a>
            </div>
        </form>
    </div>

    <!-- Grid de productos -->
    {% if productos %}
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem;">
            {% for producto in productos %}
                <div style="background: white; border-radius: 10px; box-shadow: var(--box-shadow); overflow: hidden; transition: var(--transition);">
                    <div style="height: 200px; background: var(--light); display: flex; align-items: center; justify-content: center;">
                        {% if producto.imagen %}
                            <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" style="max-height: 100%; max-width: 100%; object-fit: cover;">
                        {% else %}
                            <i class="fas fa-box" style="font-size: 3rem; color: var(--gray);"></i>
                        {% endif %}
                    </div>
                    
                    <div style="padding: 1.5rem;">
                        <h3 style="margin-bottom: 0.5rem; color: var(--primary);">{{ producto.nombre }}</h3>
                        <p style="color: var(--gray); margin-bottom: 1rem; font-size: 0.9rem;">
                            <strong>Categoría:</strong> {{ producto.categoria.nombre }}
                        </p>
                        <p style="margin-bottom: 1rem; font-size: 0.9rem;">{{ producto.descripcion|truncatewords:20 }}</p>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">
                                ${{ producto.precio }}
                            </span>
                            <span style="color: {% if producto.stock > 10 %}green{% elif producto.stock > 0 %}orange{% else %}red{% endif %};">
                                {% if producto.stock > 0 %}
                                    {{ producto.stock }} en stock
                                {% else %}
                                    Sin stock
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 3rem; background: var(--light); border-radius: 10px;">
            <i class="fas fa-search" style="font-size: 3rem; color: var(--gray); margin-bottom: 1rem;"></i>
            <h3 style="color: var(--gray);">No se encontraron productos</h3>
            <p>Intenta con otros términos de búsqueda o categorías.</p>
        </div>
    {% endif %}
</div>
{% endblock %}