{% extends 'base.html' %}
{% load static %}

{% block title %}Cambiar contraseña - SIEER Chile{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/login_css.css' %}">
<style>
    /* Botón ghost "Volver al panel" */
    .back-to-panel {
        margin-top: 1.2rem;
        display: flex;
        justify-content: center;
    }

    .back-to-panel a {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.65rem 1.6rem;
        border-radius: 999px;
        border: 1px solid rgba(0, 255, 136, 0.7);
        background: transparent;
        color: #00ff88;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        text-decoration: none;
        transition: all 0.2s ease;
    }

    .back-to-panel a i {
        font-size: 0.9rem;
    }

    .back-to-panel a:hover {
        background: rgba(0, 255, 136, 0.12);
        box-shadow: 0 0 12px rgba(0, 255, 136, 0.45);
        transform: translateY(-1px);
    }
</style>
{% endblock %}

{% block content %}
<div class="login-container">
    <!-- Partículas flotantes -->
    <div class="floating-particles" id="particles"></div>

    <div class="login-card">
        <!-- Logo y título -->
        <div class="login-header">
            <div class="logo-container">
                <div class="logo-flex">
                    <img src="{% static 'img/logo.png' %}" alt="SIEER Chile Logo" class="logo-img">
                    <div class="logo-text">
                        <h1>SIEER Chile</h1>
                        <span>Panel del Cliente</span>
                    </div>
                </div>
            </div>
            <h2>Cambiar contraseña</h2>
            <p>Ingresa tu contraseña actual y luego la nueva contraseña.</p>
        </div>

        {% if form.errors %}
        <div class="alert-error">
            <i class="fas fa-exclamation-triangle"></i>
            Revisa los campos marcados. Tu contraseña no cumple con los requisitos o la actual es incorrecta.
        </div>
        {% endif %}

        <form method="post">
            {% csrf_token %}

            <div class="form-group">
                <label for="{{ form.old_password.id_for_label }}">Contraseña antigua:</label>
                <div class="form-input-wrapper">
                    <i class="fas fa-lock input-icon"></i>
                    {{ form.old_password }}
                </div>
                {{ form.old_password.errors }}
            </div>

            <div class="form-group">
                <label for="{{ form.new_password1.id_for_label }}">Contraseña nueva:</label>
                <div class="form-input-wrapper">
                    <i class="fas fa-key input-icon"></i>
                    {{ form.new_password1 }}
                </div>
                {% if form.new_password1.help_text %}
                <div class="password-help">
                    {{ form.new_password1.help_text|safe }}
                </div>
                {% endif %}
                {{ form.new_password1.errors }}
            </div>

            <div class="form-group">
                <label for="{{ form.new_password2.id_for_label }}">Contraseña nueva (confirmación):</label>
                <div class="form-input-wrapper">
                    <i class="fas fa-key input-icon"></i>
                    {{ form.new_password2 }}
                </div>
                {{ form.new_password2.errors }}
            </div>

            <button type="submit" class="btn-full">
                <i class="fas fa-save"></i> GUARDAR NUEVA CONTRASEÑA
            </button>
        </form>

        <!-- Botón ghost abajo -->
        <div class="back-to-panel">
            <a href="{% url 'client_dashboard' %}">
                <i class="fas fa-arrow-left"></i>
                Volver al panel
            </a>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const particlesContainer = document.getElementById('particles');
        const particleCount = 15;

        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';

            const size = Math.random() * 6 + 2;
            const left = Math.random() * 100;
            const top = Math.random() * 100;
            const delay = Math.random() * 5;
            const duration = 8 + Math.random() * 8;

            particle.style.width = `${size}px`;
            particle.style.height = `${size}px`;
            particle.style.left = `${left}%`;
            particle.style.top = `${top}%`;
            particle.style.animationDelay = `${delay}s`;
            particle.style.animationDuration = `${duration}s`;
            particle.style.opacity = Math.random() * 0.3 + 0.1;

            particlesContainer.appendChild(particle);
        }

        // Agregar clases y placeholders a los inputs del formulario Django
        const mapping = [
            { selector: '#id_old_password', placeholder: 'Ingresa tu contraseña actual' },
            { selector: '#id_new_password1', placeholder: 'Ingresa tu nueva contraseña' },
            { selector: '#id_new_password2', placeholder: 'Repite tu nueva contraseña' }
        ];

        mapping.forEach(item => {
            const input = document.querySelector(item.selector);
            if (input) {
                input.classList.add('form-input');
                input.setAttribute('placeholder', item.placeholder);
            }
        });
    });
</script>
{% endblock %}